<html>
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="/mydashboard/favicon-192x192.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link rel="manifest" href="/mydashboard/manifest.json">
        <title>Dashbboard</title>
    </head>
    <body>
        <div id="main">
            <iframe
                src="https://forecaurl/details#content"
                width="400px"
                height="900px"
                frameborder="0"
                loading="lazy"
                noresize=yes frameborder=0 marginheight=0 marginwidth=0
            ></iframe>

            <iframe
                src="https://forecaurl#inline-banner-mobi-1"
                width="600px"
                height="900px"
                frameborder="0"
                loading="lazy"
                noresize=yes frameborder=0 marginheight=0 marginwidth=0
            ></iframe>

            <iframe
                src="https://www.sahkoa.io/"
                width="400px"
                height="900px"
                frameborder="0"
                loading="lazy"
                noresize=yes frameborder=0 marginheight=0 marginwidth=0
            ></iframe>

            <div id="info" class="prevent-select">
                <span id="current_date"></span>
                <span id="current_time"></span>
                <span id="reload_time"></span>
            </div>
        </div>

        <a href="/mydashboard/">Reset foreca</a>
    </body>
    <script>
        // Get from query param
        var forecaURL = new URLSearchParams(window.location.search).get('forecaURL');
        if (!forecaURL) {
            forecaURL = prompt('Anna Foreca linkki', 'https://www.foreca.fi/Finland/Kontiolahti/Kylmaoja');
            window.location.search = `forecaURL=${forecaURL}`;
        }
        if (forecaURL.includes('details')) {
            forecaURL = forecaURL.split('details')[0];
        }
        if (forecaURL.includes('https://')) {
            forecaURL = forecaURL.split('https://')[1];
        }

        for (const frame of document.querySelectorAll('iframe')) {
            if (frame.src.includes('forecaurl')) {
                frame.src = frame.src.replace('forecaurl', forecaURL);
                console.log(frame.src);
            } else {
                console.log('No forecaurl in ', frame.src);
            }
        }

        var current_time = document.getElementById('current_time');
        var date = new Date();
        current_time.innerHTML = date.toLocaleTimeString('fi-FI');
        var current_date = document.getElementById('current_date');
        current_date.innerHTML = date.toLocaleDateString('fi-FI');
        var reload_time = document.getElementById('reload_time');

        var info = document.getElementById('info');
        info.addEventListener('click', function() {
            window.location.reload();
        });
        const reloadTime = new Date();
        reloadTime.setMinutes(reloadTime.getMinutes() + 1);
        // Fin next time when it's XX.01 or XX.31
        reloadTime.setSeconds(0);
        reloadTime.setMilliseconds(0);
        if (reloadTime.getMinutes() < 30) {
            reloadTime.setMinutes(30);
        } else {
            reloadTime.setHours(reloadTime.getHours() + 1);
            reloadTime.setMinutes(0);
        }
        reloadTime.setMinutes(reloadTime.getMinutes() + 1);
        console.log(reloadTime);
        setInterval(function() {
            if (new Date() > reloadTime) {
                window.location.reload();
            }
            reload_time.innerHTML = Math.floor((reloadTime - new Date()) / 1000) + 's';
        }, 1000);

    </script>
    <style>
        #main {
            display: flex;
        }
        #info {
            display: flex;
            flex-direction: column;
            align-items: center;

            position: fixed;
            top: 0;
            right: 0;
            width: 100px;
            height: 70px;
            background-color: #f0f0f0;

            z-index: 9999;
        }
        .prevent-select {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }
    </style>
</html>